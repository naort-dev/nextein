#!/usr/bin/env node

const { join, resolve } = require('path')
const { spawn } = require('cross-spawn')
const { watch } = require('fs')

const pkg = require('../package.json')


const cmd = process.argv[2] || ''

if (new Set(['--version', '-v']).has(cmd)) {
  console.log(`${pkg.name} v${pkg.version}`)
  process.exit(0)
}

const bin = 'next'//join(__dirname, `next ${cmd}`)

const args = process.argv.slice(2)

const startProcess = () => {
  const proc = spawn(bin, args, { stdio: 'inherit', customFds: [0, 1, 2] })
  proc.on('close', (code, signal) => {
    if (code !== null) {
      process.exit(code)
    }
    if (signal) {
      if (signal === 'SIGKILL') {
        process.exit(137)
      }
      console.log(`got signal ${signal}, exiting`)
      process.exit(1)
    }
    process.exit(0)
  })
  proc.on('error', (err) => {
    console.error(err)
    process.exit(1)
  })
  return proc
}

let proc = startProcess()
